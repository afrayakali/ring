<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AFRA: NEON DYNAMICS</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --neon-blue: #00f2ff; --neon-pink: #ff00ff; }
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', system-ui, sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; }

        /* UI Katmanƒ± */
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .pointer { pointer-events: auto; cursor: pointer; }

        /* √úst Men√º */
        .header { display: flex; justify-content: space-between; padding: 25px; align-items: center; }
        .author-link { color: var(--neon-blue); text-decoration: none; font-weight: bold; font-size: 16px; text-shadow: 0 0 10px var(--neon-blue); letter-spacing: 1px; transition: 0.3s; }
        .author-link:hover { opacity: 0.7; }

        /* Skor ve B√∂l√ºm Bilgisi */
        .stats-container { text-align: center; margin-top: 5px; pointer-events: none; }
        .score-val { font-size: 60px; font-weight: 200; opacity: 0.9; letter-spacing: 5px; margin: 0; line-height: 1; }
        .lvl-tag { font-size: 12px; color: #fff; background: rgba(255,255,255,0.15); padding: 4px 12px; border-radius: 20px; display: inline-block; margin-bottom: 8px; letter-spacing: 2px; text-transform: uppercase; }
        .max-score { font-size: 12px; opacity: 0.5; margin-top: 5px; letter-spacing: 1px; }

        /* Ayarlar ve Pause Paneli */
        #settings-panel {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(10, 10, 20, 0.98); border: 1px solid #333; padding: 30px; border-radius: 30px;
            display: none; text-align: center; min-width: 280px; box-shadow: 0 0 60px rgba(0,0,0,1);
        }

        .btn { background: none; border: 1px solid #fff; color: #fff; padding: 12px 30px; margin: 10px; border-radius: 50px; cursor: pointer; font-family: inherit; font-size: 14px; transition: 0.3s; }
        .btn:hover { background: #fff; color: #000; }
        
        #pause-btn { font-size: 24px; background: rgba(255,255,255,0.05); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border: 1px solid #333; }

        .info-box { font-size: 12px; color: #888; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-top: 20px; text-align: left; line-height: 1.6; }
        .info-box strong { color: var(--neon-blue); }
    </style>
</head>
<body>

<div class="ui-layer">
    <div class="header">
        <a href="https://afrayakali.github.io/web" target="_blank" class="author-link pointer">AFRA YAKALI</a>
        <div id="pause-btn" class="pointer" onclick="togglePause()">‚è∏</div>
        <div class="pointer" onclick="toggleSettings()" style="font-size: 28px;">‚öôÔ∏è</div>
    </div>
    
    <div class="stats-container">
        <div id="lvl-display" class="lvl-tag">B√ñL√úM 1: NEON CITY</div>
        <p class="score-val" id="score-val">0</p>
        <p class="max-score">EN Y√úKSEK: <span id="max-val">0</span></p>
    </div>

    <div id="settings-panel" class="pointer">
        <h2 id="panel-status" style="color: var(--neon-blue); letter-spacing: 3px; margin-top: 0;">DURDURULDU</h2>
        
        <div style="margin: 25px 0;">
            <label style="font-size: 18px; cursor:pointer; display: flex; align-items: center; justify-content: center;">
                üîä SES <input type="checkbox" id="sound-toggle" checked style="transform: scale(1.6); margin-left: 15px;">
            </label>
        </div>

        <button class="btn" onclick="toggleSettings()" style="border-color: var(--neon-blue); color: var(--neon-blue); width: 80%; font-weight: bold;">DEVAM ET</button>
        
        <div class="info-box" id="ios-desc">
            <strong>UYGULAMAYI Y√úKLE:</strong><br>
            iPhone/iPad kullanƒ±yorsan Safari'de <strong>Payla≈ü</strong> ikonuna basƒ±p <strong>'Ana Ekrana Ekle'</strong> diyebilirsin.
        </div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score-val');
    const maxEl = document.getElementById('max-val');
    const lvlEl = document.getElementById('lvl-display');
    const pauseBtn = document.getElementById('pause-btn');
    
    let gameActive = true;
    let isPaused = false;
    let score = 0;
    let level = 1;
    let maxScore = localStorage.getItem('afraMaxScore') || 0;
    maxEl.innerText = maxScore;

    let frame = 0, speed = 5, spawnRate = 80;
    let playerColorIndex = 0; 

    // B√ñL√úM TEMALARI (Renk Mantƒ±ƒüƒ±)
    const themes = [
        { name: "NEON CITY", colors: ['#00f2ff', '#ff00ff'], bg: 'rgba(0,0,0,0.25)' },
        { name: "BIOHAZARD", colors: ['#39ff14', '#ffff00'], bg: 'rgba(5,15,5,0.25)' },
        { name: "VOLCANO", colors: ['#ff4e00', '#7a00ff'], bg: 'rgba(15,5,5,0.25)' },
        { name: "ICE & FIRE", colors: ['#ffffff', '#ff0000'], bg: 'rgba(5,5,15,0.25)' },
        { name: "CYBERPUNK", colors: ['#ffee00', '#00ffcc'], bg: 'rgba(10,0,10,0.25)' }
    ];

    // SES Sƒ∞STEMƒ∞
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSfx(f, t = 'sine', d = 0.1) {
        if(!document.getElementById('sound-toggle').checked) return;
        try {
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        } catch(e) {}
    }

    function togglePause() {
        if(!gameActive) return;
        isPaused = !isPaused;
        pauseBtn.innerText = isPaused ? "‚ñ∂Ô∏è" : "‚è∏";
        document.getElementById('settings-panel').style.display = isPaused ? 'block' : 'none';
        if(!isPaused) loop();
    }

    function toggleSettings() { togglePause(); }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.onresize = resize; resize();

    let obstacles = [];

    // RENK DEƒûƒ∞≈ûTƒ∞RME MANTIƒûI
    const switchColor = () => {
        if(!gameActive || isPaused) return;
        playerColorIndex = playerColorIndex === 0 ? 1 : 0;
        playSfx(350 + (playerColorIndex * 100), 'triangle', 0.08);
    };

    // Giri≈ü Kontrolleri
    window.ontouchstart = (e) => { if(!e.target.closest('.pointer')) { e.preventDefault(); switchColor(); } };
    window.onmousedown = (e) => { if(!e.target.closest('.pointer')) switchColor(); };

    function spawn() {
        if(frame % spawnRate === 0) {
            obstacles.push({
                y: -50,
                x: canvas.width / 2,
                type: Math.random() > 0.5 ? 0 : 1,
                r: 20
            });
        }
    }

    function loop() {
        if(!gameActive || isPaused) return;
        
        let currentTheme = themes[(level - 1) % themes.length];
        ctx.fillStyle = currentTheme.bg;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Oyuncu Halkasƒ± (Hedef)
        let pCol = currentTheme.colors[playerColorIndex];
        ctx.shadowBlur = 30; ctx.shadowColor = pCol;
        ctx.strokeStyle = pCol; ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.arc(canvas.width / 2, canvas.height - 130, 48, 0, Math.PI * 2);
        ctx.stroke();
        ctx.shadowBlur = 0;

        obstacles.forEach((o, i) => {
            o.y += speed;
            let oCol = currentTheme.colors[o.type];
            
            ctx.fillStyle = oCol;
            ctx.shadowBlur = 15; ctx.shadowColor = oCol;
            ctx.beginPath();
            ctx.arc(o.x, o.y, o.r, 0, Math.PI * 2);
            ctx.fill();

            // √áarpƒ±≈üma B√∂lgesi (Halkaya deƒüdiƒüi an)
            if(o.y > canvas.height - 180 && o.y < canvas.height - 80) {
                if(o.type === playerColorIndex) {
                    score++;
                    scoreEl.innerText = score;
                    obstacles.splice(i, 1);
                    playSfx(600 + (score * 2), 'sine', 0.05);

                    // B√∂l√ºm Atlatma (Her 15 Skor)
                    if(score % 15 === 0) {
                        level++;
                        let nextTheme = themes[(level - 1) % themes.length];
                        lvlEl.innerText = `B√ñL√úM ${level}: ${nextTheme.name}`;
                        speed += 0.5;
                        spawnRate = Math.max(35, spawnRate - 5);
                        playSfx(880, 'square', 0.2);
                    }

                    // Max Skor G√ºncelleme
                    if(score > maxScore) {
                        maxScore = score;
                        maxEl.innerText = maxScore;
                        localStorage.setItem('afraMaxScore', maxScore);
                    }
                } else { endGame(); }
            }
            // Ka√ßƒ±rma Kontrol√º
            if(o.y > canvas.height) endGame();
        });

        spawn();
        frame++;
        requestAnimationFrame(loop);
    }

    function endGame() {
        gameActive = false;
        playSfx(100, 'sawtooth', 0.5);
        setTimeout(() => {
            alert(`Sƒ∞STEM Kƒ∞Lƒ∞TLENDƒ∞!\n\nSkor: ${score}\nB√∂l√ºm: ${level}\nRekor: ${maxScore}`);
            location.reload();
        }, 100);
    }

    // Ba≈ülat
    loop();

    // PWA Service Worker (√áevrimdƒ±≈üƒ± destek)
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').catch(()=>{});
    }
</script>
</body>
</html>